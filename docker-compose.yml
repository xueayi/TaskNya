version: '3.8'

services:
  tasknya:
    image: xueayis/tasknya:latest
    container_name: tasknya
    ports:
      - "5000:5000"
    volumes:
      # 配置文件映射（此文件夹内必须有 default.yaml 文件）
      # - ./configs:/app/configs
      # 日志文件映射
      - ./logs:/app/logs
      # 监控目标文件映射
      - ./monitor_targets:/app/monitor_targets
      # 可选：额外的监控目标目录映射（根据实际需求修改）
      # - /path/to/your/training/files:/app/monitor/training
      # - /path/to/your/log/files:/app/monitor/logs
    environment:
      # Python 环境
      - PYTHONUNBUFFERED=1
      - PYTHONPATH=/app
      # TaskNya 配置
      - TASKNYA_HOST=0.0.0.0
      - TASKNYA_PORT=5000
      - TASKNYA_DEBUG=0
      # 调试模式（取消注释以启用）
      # - TASKNYA_DEBUG=1
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "python", "-c", "import requests; requests.get('http://localhost:5000/')"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s

  # 可选：调试模式服务
  # tasknya-debug:
  #   image: xueayis/tasknya:latest
  #   container_name: tasknya-debug
  #   ports:
  #     - "5001:5000"
  #   volumes:
  #     - ./configs:/app/configs
  #     - ./logs:/app/logs
  #     - ./monitor_targets:/app/monitor_targets
  #   environment:
  #     - PYTHONUNBUFFERED=1
  #     - TASKNYA_DEBUG=1
  #   restart: "no"